<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Home</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <!-- Bootstrap 1 Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="asset/css/navbar.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
		<div class="container">
			<a class="navbar-brand" href="home.html">
				<b class="text-danger fs-5">Questify</b>
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navigation">
				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
					<li class="nav-item me-1">
						<a class="nav-link text-danger" aria-current="page" href="#"><i class="bi bi-house-door"></i> <b>Home</b></a>
					</li>
					<li class="nav-item me-1">
						<a class="nav-link" aria-current="page" href="answer.html"><i class="bi bi-pencil-square"></i> Answer</a>
					</li>
					<div class="notif-profile-m">
						<li class="nav-item">
							<a class="nav-link" aria-current="page" href="profile.html"><i class="bi bi-person-circle"></i> Profile</a>
						</li>
						<hr>
						<li class="nav-item">
							<a class="btn btn-danger btn-sm w-100 rounded-4" aria-current="page" id="btnLogout2" href="#">Logout</a>
						</li>
					</div>
					<div class="notif-profile-d align-items-center">
						<div class="mx-2">
							<a type="button" data-bs-toggle="dropdown" aria-expanded="false">
								<img id="avatar2"
								class="rounded-pill" height="30" alt="Profile"loading="lazy"/>
							</a>
							<div class="dropdown-menu-end position-absolute">
								<ul class="dropdown-menu position-relative">
									<li><a class="dropdown-item" href="profile.html">Profile</a></li>
									<li><a class="dropdown-item" id="btnLogout" href="#">Logout</a></li>
								</ul>
							</div>
						</div>
					</div>
				</ul>
			</div>
		</div>
	</nav>

    <main class="mt-4">
    	<div class="container">
    		<div class="row">
	    		<div class="col-md-2 d-none d-sm-block mb-4">
	    			<div class="position-sticky" style="top: 5rem;">
						
    					<div id="topicsUser">

						</div>
    				<hr>
    				<div class="mt-2">
    					<div class="text-secondary">
    						<a href="#" class="text-decoration-none"><small class="text-secondary">About </small></a> &#x2022;
    						<a href="#" class="text-decoration-none"><small class="text-secondary">Careers </small></a> &#x2022;
    						<a href="#" class="text-decoration-none"><small class="text-secondary"> Terms </small></a> &#x2022;
    						<a href="#" class="text-decoration-none"><small class="text-secondary">Privacy </small></a> &#x2022;
    						<a href="#" class="text-decoration-none"><small class="text-secondary"> Businesses </small></a> &#x2022;
    						<a href="#" class="text-decoration-none"><small class="text-secondary"> Press</small></a>
    					</div>
    				</div>
	    			</div>
	    		</div>
	    		<div class="col-md-7 col-sm-12">
					<div class="modal fade" id="createSpaceModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered modal-lg">
							<div class="modal-content">
								<form onsubmit="return false">
									<div class="modal-header">
										<span class="fs-5"><b>Create a Space</b></span>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeSpace"></button>
									</div>
									<div class="modal-body">
										<label class="form-label">
											<b>Name</b><br>
											<small>This can be changed later</small>
										</label>
										<input type="text" class="form-control" id="space_name">
										<div class="text-danger" id="invalid_space_name" style="display: none;">
											<small id="invalid_msg_space_name">
											</small>
										</div>	
										
										<label class="form-label mt-3">
											<b>Description</b><br>
											<small>Include a few keywords to show people what to expect if they join</small>
										</label>
										<input type="text" class="form-control" id="space_description">
										<div class="text-danger" id="invalid_space_description" style="display: none;">
											<small id="invalid_msg_space_description">
											</small>
										</div>	

									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-sm btn-light rounded-4" data-bs-dismiss="modal" id="cancelSpace">Cancel</button>
										<button type="submit" class="btn btn-primary btn-sm rounded-4" id="createSpace">Create</button>
									</div>
								</form>
							</div>
						</div>
					</div>
	    			<div class="card rounded-0">
	    				<div class="card-body">
	    					<div class="row">
	    						<div class="col-1 text-end">
	    							<a href="profile.html">
	    								<img class="rounded-circle" width="35px" id="avatar1">
	    							</a>
	    						</div>
	    						<div class="col-10 ms-2">
	    							<div class="input-group input-group-sm">
	    								<input class="form-control rounded-4" name="" placeholder="What do you want to ask or share?" data-bs-toggle="modal" data-bs-target="#askModal">
	    							</div>
	    							<div class="row mt-2">
	    								<div class="col-5 text-center">
	    									<a href="#" class="text-decoration-none text-secondary" data-bs-toggle="modal" data-bs-target="#askModal">
	    										<i class="bi bi-question-square me-1"></i>
	    										<small>Ask</small>
	    									</a>
	    								</div>
										<div class="modal fade" id="askModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered modal-lg">
												<div class="modal-content">
													<form>
														<div class="modal-header">
															<span class="fs-5"><b>Add Question</b></span>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeQuestion"></button>
														</div>
														<div class="modal-body">
															<label class="form-label">
																<b>Question</b><br>
																<small>Start your question with "What","How","Why", etc.</small>
															</label>
															<input type="text" class="form-control" id="question" name="question">
															<div class="text-danger" id="invalid_question" style="display: none;">
																<small id="invalid_msg_question">
																</small>
															</div>														  
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-sm btn-light rounded-4" data-bs-dismiss="modal" id="cancelQuestion">Cancel</button>
															<input type="submit" class="btn btn-primary btn-sm rounded-4" id="btnAddQuestion" value="Submit">
														</div>
													</form>
													
												</div>
											</div>
										</div>
	    								<div class="col-1 text-secondary">
	    									|
	    								</div>
	    								<div class="col-5 text-center">
	    									<a href="answer.html" class="text-decoration-none text-secondary">
	    										<i class="bi bi-pencil-square me-1"></i>
	    										<small>Answer</small>
	    									</a>
	    								</div>
	    				
										<div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered modal-lg">
												<div class="modal-content">
													<form onsubmit="return false">
														<div class="modal-header">
															<span class="fs-5"><b>Create Post</b></span>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closePost"></button>
														</div>
														<div class="modal-body">
															<label class="form-label">
																<b>Post</b><br>
																<small>Say something</small>
															</label>
															<input type="text" class="form-control" id="post">
															<div class="text-danger" id="invalid_post" style="display: none;">
																<small id="invalid_msg_post">
																</small>
															</div>														  
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-sm btn-light rounded-4" data-bs-dismiss="modal" id="cancelPost">Cancel</button>
															<button type="submit" class="btn btn-primary btn-sm rounded-4" id="btnPost">Post</button>
														</div>
													</form>
												</div>
											</div>
										</div>
	    							</div>
	    						</div>
	    					</div>
	    				</div>
	    			</div>

					<div id="questionsWithAnswer">

					</div>
	    		</div>

	    		<div class="col-md-3 d-none d-sm-block mb-4">
	    			<div class="position-sticky" style="top: 5rem;">
	    				<div class="card rounded-0">
	    					<div class="card-body">
			    				<img src="asset/images/ad-1.gif" width="100%">
			    				<hr>
								<div class="text-center">
									<small class="text-secondary">ADVERTISEMENT</small>
								</div>
	    					</div>
	    				</div>
	    			</div>
	    		</div>
    		</div>
    	</div>
   		
    </main>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

	<script>
		
		let user_id = sessionStorage.getItem('id')

		if(user_id == null){
			window.location.href = "signin.html"
		}

		document.getElementById('avatar1').src = 'https://ui-avatars.com/api/?name=' + sessionStorage.getItem('name')
		document.getElementById('avatar2').src = 'https://ui-avatars.com/api/?name=' + sessionStorage.getItem('name')


		let questionsWithAnswer = document.getElementById('questionsWithAnswer')
		let btnAddQuestion = document.getElementById('btnAddQuestion')
		let invalid_question = document.getElementById('invalid_question')
		let invalid_msg_question = document.getElementById('invalid_msg_question')
		let btnLogout = document.getElementById('btnLogout')

		function showAlert(message) {
			invalid_question.style.display = 'block'
			invalid_msg_question.innerHTML = message
		}
		
		btnAddQuestion.addEventListener('click', async (e) => {
    
			e.preventDefault()

			try{
				const res = await fetch('http://localhost:3000/api/questions', {
					method: 'POST',
					body: JSON.stringify({
						question: question.value,
						user_id: user_id
					}),
					headers: {
						'Content-Type': 'application/json'
					}
				})

				const data = await res.json()
				
				if(res.status != 200){

					alert(data.message)

				}else{
					
					alert(data.message)
					location.href="question.html?id=" + data.data.id
				}

			}catch(err)
			{
				alert('Something wrong. please try again later!')
				console.log(err.message)
			}
		})

		btnLogout.addEventListener('click', async (e) => {

			e.preventDefault()

			sessionStorage.clear()

			window.location.href = "signin.html"

		});

		async function getUserTopics()
		{
			try{

			const res = await fetch('http://localhost:3000/api/user/topics', {
			method: 'POST',
			body: JSON.stringify({
				user_id: user_id,
			}),
			headers: {
				'Content-Type': 'application/json'
			}
			})

			const data = await res.json()

			if(res.status != 200){

			alert(data.message)

			}else{

			let result = data.data;

			dataStore = ""

			result.forEach(element => {
			
				dataStore += 
				`
				<div class="row mt-3">
					<div class="col-2">
						<img src="https://ui-avatars.com/api/?${element.topic}" class="rounded-circle" width="35px">
					</div>
					<div class="col-10 text-end">
						<button class="btn btn-sm text-secondary">${element.topic}</button>
					</div>
    			</div>
				`
			})

			document.getElementById('topicsUser').innerHTML = dataStore

			}

			}catch(err)
			{
			alert('Something wrong. please try again later!')
			console.log(err.message)
			}
		}

		async function getAllQuestionsWithAnswer()
		{
			try{

				const res = await fetch('http://localhost:3000/api/questions/answer', {
					method: 'POST',
					body: JSON.stringify({
						user_id: user_id
					}),
					headers: {
						'Content-Type': 'application/json'
					}
				})

				const data = await res.json()

				if(res.status != 200){

					alert(data.message)

				}else{

					let result = data.data

					dataStore = ""

					result.forEach(element => {


						dataStore += 

						`
						<div class="card mt-3 mb-3 rounded-0">
							<div class="card-body">
								<div class="row">
									<div class="col-1 mt-2 text-end">
										<img src="https://ui-avatars.com/api/?name=${element.user_name}" class="rounded-circle" width="35px">
									</div>
									<div class="col-9">
										<small class="ms-2"><b>${element.user_name}</b></small>
										<div class="row">
											<div class="col-12 ms-2">
												<small class="text-secondary">${element.user_profile_credential}  &#x2022;  ${new Date(element.created_at._seconds * 1000).toDateString()}</small>  
											</div>
										</div>
									</div>
									<div class="col-2 text-end">
									</div>
								</div>
								<div class="mt-3">
									<div class="fs-6">
										<a href="question.html?id=${element.question_id}" class="text-dark link-offset-2 link-offset-3-hover link-underline-opacity-0 link-underline-dark link-underline-opacity-75-hover"><b>${element.question_question}</b></a>
									</div>
								</div>
								<div class="mt-3">
									<div class="fs-6">
										${element.answer}
									</div>
								</div>
								<div class="mt-3">
								</div>
								<div class="row mt-3">						
								</div>
							</div>
						</div>
						
						`
					})

					questionsWithAnswer.innerHTML = dataStore

				}
			}
			
			catch(err)
			{
				alert('Something wrong. please try again later!')
				console.log(err.message)
			}
		}

		getAllQuestionsWithAnswer()
		getUserTopics()

	</script>

	<!-- Custom JS -->
    <script src="asset/js/question.js"></script>
	<script src="asset/js/space.js"></script>
	<script src="asset/js/post.js"></script>

	

</body>
</html>